<%- include('partials/head', { title: "Admin Dashboard | CarGo", pageStyle: "css/admin.css" }) %>
<body>
    <%- include('partials/adminnav') %>
    <section class="admin-dashboard">
        <h2>Pending Requests</h2>
        
        <table>
            <thead>
                <tr>
                    <!-- <th>Booking ID</th> -->
                    <th>User</th>
                    <th>Car</th>
                    <th>Current Dates</th>
                    <th>Requested New Dates</th> <!-- Show new dates -->
                    <th>Total Price</th>
                    <th>Request Type</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% if (pendingRequests.length === 0) { %>
                    <tr><td colspan="8">No pending requests</td></tr>
                <% } else { %>
                    <% pendingRequests.forEach(request => { %>
                        <tr>
                            <!-- <td><%= request.id %></td> -->
                            <td><%= request.User.email %></td>
                            <td><%= request.Car.brand %> - <%= request.Car.model %></td>
                            <td><%= request.start_date %> to <%= request.end_date %></td>
                            <td>
                                <% if (request.new_start_date && request.new_end_date) { %>
                                    <%= request.new_start_date %> to <%= request.new_end_date %>
                                <% } else { %>
                                    No Edit Requested
                                <% } %>
                            </td>
                            <td>$<%= request.total_price %></td>
                            <td><%= request.request_status %></td>
                            <td>
                                <div class="action-buttons">
                                <form action="/admin/approve-request" method="POST">
                                    <input type="hidden" name="booking_id" value="<%= request.id %>">
                                    <button type="submit" class="approve-btn">Approve</button>
                                </form>
                                <form action="/admin/reject-request" method="POST">
                                    <input type="hidden" name="booking_id" value="<%= request.id %>">
                                    <button type="submit" class="reject-btn">Reject</button>
                                </form>
                            </div>
                            </td>
                        </tr>
                    <% }) %>
                <% } %>
            </tbody>
            
            
        </table>
    </section>
    <%- include('partials/footer') %>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuToggle = document.querySelector('.menu-toggle');
        const navLinks = document.querySelector('.nav-links');

        menuToggle.addEventListener('click', function() {
            navLinks.classList.toggle('active');
        });
    });
    </script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".approve-btn, .reject-btn").forEach(button => {
            button.addEventListener("click", async function(event) {
                event.preventDefault();

                const form = this.closest("form");
                const bookingId = form.querySelector("input[name='booking_id']").value;
                const actionUrl = form.getAttribute("action");

                if (!bookingId) {
                    alert("‚ùå Error: Booking ID is missing.");
                    return;
                }

                console.log("üìå Sending Request:", { booking_id: bookingId, action: actionUrl });

                const response = await fetch(actionUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ booking_id: bookingId })
                });

                const result = await response.json();
                console.log("üìå Server Response:", result);

                if (response.ok) {
                    alert("‚úÖ Request processed successfully!");
                    location.reload();
                } else {
                    alert("‚ùå Failed to process request: " + result.message);
                }
            });
        });
    });
</script>


    
    
    
</html>
